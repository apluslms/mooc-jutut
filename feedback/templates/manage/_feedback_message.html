{% load i18n %}
{% load humanize %}
{% load feedback %}
{% comment %}
	expects to be used under bootstrapped.html
	expects from context:
		active
		fb.feedback
		fb.feedback_form
{% endcomment %}

{% with feedback=fb.feedback %}
<div class="feedback-message {% if active %}active{% endif %}">
	<table class="table table-sm" style="border: 0px transparent;">
		<col class="field-names"/>
		<col/>
		{% for field in fb.feedback_form %}
			{% if field.has_data %}
				{# FIXME: clean this up #}
				<tr class="{{ field.is_text|yesno:'text,data only-expanded collapse' }}">
					<th class="only-expanded collapse">
						{{ field.label|default:field.name }}
						{% if field.help_text %}
							<span
								data-bs-toggle="tooltip"
								data-bs-trigger="hover click"
								data-bs-placement="bottom"
								data-bs-html="true"
								title="{{ field.help_text }}"
								>
								<span class="bi bi-info-circle"></span>
							</span>
						{% endif %}
						{% if not field.field.required %}
							<span
								data-bs-toggle="tooltip"
								data-bs-trigger="hover click"
								data-bs-placement="bottom"
								data-bs-html="true"
								title="{% trans 'This field was <b>not</b> required' %}"
								>
								<span class="badge text-bg-info">{% trans "optional" %}</span>
							</span>
						{% endif %}
					</th>
					<td>
						{% for val in field.display_data_list %}
							{% if not forloop.first %}<br>{% endif %}
							{{ val }}
						{% empty %}
							{{ field.display_data }}
						{% endfor %}
					</td>
				</tr>
			{% endif %}
		{% endfor %}
	</table>
	<div class="toggle-showall card-footer panel-footer collapsed"
		role="button" aria-expanded="false" tabindex=0
		title="{% trans 'Show all feedback fields' %}"
	>
		<span class="timestamp">
			{{ feedback.timestamp|naturaltime }}
			<i class="bi bi-chevron-down" aria-hidden="true"></i>
			<i class="bi bi-chevron-up" aria-hidden="true"></i>
			<span class="visually-hidden">{% trans "Toggle feedback details" %}</span>
		</span>
	<!-- change collapse-functionality so that only the classes within the clicked message are toggled -->
		<div class="feedback-msg-bottom only-expanded collapse">
			<div class="btn-group btn-group-sm" role="group">
				<a
					class="btn btn-primary"
					data-bs-toggle="tooltip"
					data-bs-trigger="hover"
					data-bs-placement="bottom"
					title="{% trans 'Show submission in A+' %}"
					href="{{ feedback.submission_html_url }}"
					>
					<span class="bi bi-file-earmark-fill" aria-hidden="true"></span>
					A+
				</a>
			</div>
			<span>{{ feedback.timestamp|date:"d.m." }} {{ feedback.timestamp|time:"H:i" }}</span>
		</div>
	</div> <!--.panel-footer-->
</div>
{% endwith %}
